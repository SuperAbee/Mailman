#### **基于可见光传输信息的终端通信三层协议模型**

![在这里插入图片描述](https://img-blog.csdnimg.cn/20200226191930124.JPG)
**背景**：经历了一星期的编码工作，遇到了诸多问题。除去技术上的瓶颈，最令人困扰的就是随着代码量的增加、需求的改动，代码的修改显得愈加困难，一个技术点的变更就需要多处代码改动，最后不得不另写一个版本的编解码器。


**反思**：开始写代码之前，规划好了实现的整体流程，自认为非常清晰。实践中却四处碰壁，代码越写越长，逻辑越写越乱。因此意识到：项目需要一个更好的架构。“流程”式的面向过程的方案已经不适用与当前需求，所以在这里提出三层协议模型。

**初衷**：降低层与层之间的依赖，增强各层逻辑复用性，使项目迭代更轻松。

**原则**：参考*Patterns of Enterprise Application Architecture*一书

**介绍**：
编码层：该层负责传输信息的编解码并且附带纠错机制，即选择编码格式，添加纠错码。该层将格式信息和纠错码版本信息封装进有效信息头部，传入上层。

图像层：该层负责将下层数据嵌入图像并提供图像矫正机制，接收来自编码层的数据，设置定位点，嵌入图像层协议的信息（做为头部），嵌入编码层数据。

视频层：该层负责图像合成为视频并提供鉴别有效帧服务。

以上为编码过程，逆向分析可得解码过程。

**实例**：在采用三层协议模型之前的编解码版本，为解决鉴别首帧有效帧的问题，用的是在编码阶段就嵌入前同步码，比如要传输“HelloWorld”，在编码嵌入前加入“Start”,变成“StartHelloWorld”，解码检测到“Start”时判定为首帧。这种设计显然违背了分层协议的原则，由视频层负责的有效帧判定涉及到了下两层提供的服务。
